schema: '2.0'
stages:
  dataset_split:
    cmd: python3 src/dataset_split.py
    deps:
    - path: data/raw/casting
      md5: b333fcc1e3fbef34d7e404ab1fd8af37.dir
      size: 32402383
      nfiles: 1300
    - path: src/dataset_split.py
      md5: fd014d88baab2e5545b402d3fad2fa9b
      size: 2502
    - path: src/utils/dvc/params.py
      md5: d87b352ff952b8466547c02182996e48
      size: 1285
    - path: src/utils/misc.py
      md5: e29c4af95c5e5d4228701c6303e83b86
      size: 3503
    params:
      params.yaml:
        all.dataset: casting
        all.seed: 13
        dataset_split.shuffle: true
        dataset_split.split_ratio:
        - 0.8
        - 0.1
        - 0.1
    outs:
    - path: data/processed/casting/test
      md5: d245fc8b63006e526dd4ede868c6a663.dir
      size: 3261243
      nfiles: 132
    - path: data/processed/casting/train
      md5: 1f4833d5d268687f067ae427f9ba5046.dir
      size: 25933889
      nfiles: 1039
    - path: data/processed/casting/val
      md5: 76e2daf77649bf04d10716ce03bf6394.dir
      size: 3207251
      nfiles: 129
  extract_complexity:
    cmd: python3 src/extract_complexity.py
    deps:
    - path: data/processed/casting/test
      md5: d245fc8b63006e526dd4ede868c6a663.dir
      size: 3261243
      nfiles: 132
    - path: data/processed/casting/train
      md5: 1f4833d5d268687f067ae427f9ba5046.dir
      size: 25933889
      nfiles: 1039
    - path: data/processed/casting/val
      md5: 76e2daf77649bf04d10716ce03bf6394.dir
      size: 3207251
      nfiles: 129
    - path: data/raw/general/all
      md5: 4a91d86144efa74d4475c3cdd63cbc76.dir
      size: 3462267
      nfiles: 51
    - path: src/extract_complexity.py
      md5: 39dc13d3439e52b81fad203d3d0db858
      size: 3993
    - path: src/utils/data/complexityaux.py
      md5: 00a8cf627941ec76b0633d67646990f7
      size: 6469
    - path: src/utils/data/jpegmse.py
      md5: c1481f3b211686758e89359e08f6a684
      size: 3846
    - path: src/utils/dvc/params.py
      md5: d87b352ff952b8466547c02182996e48
      size: 1285
    - path: src/utils/misc.py
      md5: e29c4af95c5e5d4228701c6303e83b86
      size: 3503
    params:
      params.yaml:
        all.dataset: casting
        all.grayscale: true
        all.scale: 255
    outs:
    - path: data/processed/casting/tabular/complexity.csv
      md5: 022eb21cb936a10753c6702ed6ced1b7
      size: 148809
    - path: visualisation/casting/complexity_hist.png
      md5: f9d243fbe558e1f1ff01faa6f241bcce
      size: 27097
  cae_hp_tuning:
    cmd: python3 src/cae_hp_tuning.py
    deps:
    - path: data/processed/casting/train
      md5: 1f4833d5d268687f067ae427f9ba5046.dir
      size: 25933889
      nfiles: 1039
    - path: data/processed/casting/val
      md5: 76e2daf77649bf04d10716ce03bf6394.dir
      size: 3207251
      nfiles: 129
    - path: src/cae_hp_tuning.py
      md5: 682b5ad7177599409fa073e40258c7cb
      size: 4492
    - path: src/utils/data/tfdatasets.py
      md5: c7d7d9a5829e73694eb2e4c3a2a0adaa
      size: 6557
    - path: src/utils/dvc/params.py
      md5: d87b352ff952b8466547c02182996e48
      size: 1285
    - path: src/utils/misc.py
      md5: e29c4af95c5e5d4228701c6303e83b86
      size: 3503
    - path: src/utils/models/kerasaux.py
      md5: b505bbc88bdc0d5b68197a2468e34a7e
      size: 11747
    - path: src/utils/models/ktmodels.py
      md5: 528c351e8b26654370dbb3697fbdaae7
      size: 10401
    params:
      params.yaml:
        all.dataset: casting
        all.grayscale: true
        all.input_size:
        - 232
        - 232
        - 1
        all.random_brightness: 0.05
        all.random_contrast: 0.05
        all.random_crop:
        - 224
        - 224
        all.random_flip: horizontal_and_vertical
        all.random_rotation: 1
        all.random_translation_height:
        - -0.05
        - 0.05
        all.random_translation_width:
        - -0.05
        - 0.05
        all.random_zoom:
        - -0.05
        - 0.05
        all.scale: 255
        all.seed: 13
        cae_hp_tuning.alpha: 0.98
        cae_hp_tuning.batch_size: 8
        cae_hp_tuning.beta: 0.93
        cae_hp_tuning.bottleneck_filters: 64
        cae_hp_tuning.early_stopping: false
        cae_hp_tuning.epochs: 130
        cae_hp_tuning.max_trials: 100
        cae_hp_tuning.min_lr: 1e-06
        cae_hp_tuning.patience: 5
        cae_hp_tuning.revive_best: true
    outs:
    - path: models/casting/bin/hp_search_best.hdf5
      md5: 83b61b3ee3fae47976411fce54e4a41e
      size: 5773808
    - path: models/casting/logs/hp_search/CAE
      md5: fb949a8d53319683eb38395d94d620df.dir
      size: 1271068434
      nfiles: 402
    - path: models/casting/logs/hp_search/hp_search_results.json
      md5: 0054cad9c864e1acb46982ca2a23c289
      size: 2532
    - path: models/casting/logs/hp_search/tb
      md5: d9a3a5c8099f33efeeccf40c8c03fdff.dir
      size: 58609071
      nfiles: 300
  cae_pretraining:
    cmd: python3 src/cae_pretraining.py
    deps:
    - path: data/raw/tiny-imagenet-200
      md5: 7a16a4c11bed2b39c5d20c304e85355c.dir
      size: 236686390
      nfiles: 120003
    - path: models/casting/bin/hp_search_best.hdf5
      md5: 83b61b3ee3fae47976411fce54e4a41e
      size: 5773808
    - path: src/cae_pretraining.py
      md5: e71a30f9e121c5fb5f84f3cca3ce274c
      size: 4699
    - path: src/utils/data/tfdatasets.py
      md5: c7d7d9a5829e73694eb2e4c3a2a0adaa
      size: 6557
    - path: src/utils/dvc/params.py
      md5: d87b352ff952b8466547c02182996e48
      size: 1285
    - path: src/utils/misc.py
      md5: e29c4af95c5e5d4228701c6303e83b86
      size: 3503
    - path: src/utils/models/kerasaux.py
      md5: b505bbc88bdc0d5b68197a2468e34a7e
      size: 11747
    params:
      params.yaml:
        all.dataset: casting
        all.grayscale: true
        all.input_size:
        - 232
        - 232
        - 1
        all.random_brightness: 0.05
        all.random_contrast: 0.05
        all.random_crop:
        - 224
        - 224
        all.random_flip: horizontal_and_vertical
        all.random_rotation: 1
        all.random_translation_height:
        - -0.05
        - 0.05
        all.random_translation_width:
        - -0.05
        - 0.05
        all.random_zoom:
        - -0.05
        - 0.05
        all.scale: 255
        all.seed: 13
        cae_pretraining.alpha: 0.98
        cae_pretraining.batch_size: 8
        cae_pretraining.beta: 0.93
        cae_pretraining.early_stopping: true
        cae_pretraining.epochs: 2
        cae_pretraining.learning_rate: 0.0015
        cae_pretraining.min_lr: 1e-05
        cae_pretraining.patience: 3
        cae_pretraining.revive_best: false
    outs:
    - path: models/casting/bin/pretrained_cae.hdf5
      md5: 65761976f244af9bcbbc735c2f2093e0
      size: 17122152
    - path: models/casting/logs/pretraining_history.csv
      md5: bfbd0cff5c59c921e8ff964e432b46f5
      size: 44
  cae_training:
    cmd: python3 src/cae_training.py
    deps:
    - path: data/processed/casting/train
      md5: 1f4833d5d268687f067ae427f9ba5046.dir
      size: 25933889
      nfiles: 1039
    - path: data/processed/casting/val
      md5: 76e2daf77649bf04d10716ce03bf6394.dir
      size: 3207251
      nfiles: 129
    - path: models/casting/bin/pretrained_cae.hdf5
      md5: 65761976f244af9bcbbc735c2f2093e0
      size: 17122152
    - path: src/cae_training.py
      md5: 675ab5e23dec6e50d5c35619c691cf49
      size: 4467
    - path: src/utils/data/tfdatasets.py
      md5: c7d7d9a5829e73694eb2e4c3a2a0adaa
      size: 6557
    - path: src/utils/dvc/params.py
      md5: d87b352ff952b8466547c02182996e48
      size: 1285
    - path: src/utils/models/kerasaux.py
      md5: b505bbc88bdc0d5b68197a2468e34a7e
      size: 11747
    params:
      params.yaml:
        all.dataset: casting
        all.grayscale: true
        all.input_size:
        - 232
        - 232
        - 1
        all.random_brightness: 0.05
        all.random_contrast: 0.05
        all.random_crop:
        - 224
        - 224
        all.random_flip: horizontal_and_vertical
        all.random_rotation: 1
        all.random_translation_height:
        - -0.05
        - 0.05
        all.random_translation_width:
        - -0.05
        - 0.05
        all.random_zoom:
        - -0.05
        - 0.05
        all.scale: 255
        all.seed: 13
        cae_training.alpha: 0.98
        cae_training.batch_size: 8
        cae_training.beta: 0.93
        cae_training.early_stopping: false
        cae_training.epochs: 130
        cae_training.min_lr: 1e-05
        cae_training.patience: 5
        cae_training.revive_best: true
    outs:
    - path: models/casting/bin/trained_cae.hdf5
      md5: 2da717ce6c3916c621c7d8abe8d2bab0
      size: 17123184
    - path: models/casting/logs/training_history.csv
      md5: 1ecd4c06c77a30a35967f1ef72d073cc
      size: 16617
  calculate_reconstruction_mse:
    cmd: python3 src/calculate_reconstruction_mse.py
    deps:
    - path: data/processed/casting/test
      md5: d245fc8b63006e526dd4ede868c6a663.dir
      size: 3261243
      nfiles: 132
    - path: data/processed/casting/train
      md5: 1f4833d5d268687f067ae427f9ba5046.dir
      size: 25933889
      nfiles: 1039
    - path: data/processed/casting/val
      md5: 76e2daf77649bf04d10716ce03bf6394.dir
      size: 3207251
      nfiles: 129
    - path: models/casting/bin/trained_cae.hdf5
      md5: 2da717ce6c3916c621c7d8abe8d2bab0
      size: 17123184
    - path: src/calculate_reconstruction_mse.py
      md5: d5635fdf04b657417b6a60b14114deeb
      size: 3254
    - path: src/utils/data/complexityaux.py
      md5: 00a8cf627941ec76b0633d67646990f7
      size: 6469
    - path: src/utils/dvc/params.py
      md5: d87b352ff952b8466547c02182996e48
      size: 1285
    params:
      params.yaml:
        all.dataset: casting
        all.grayscale: true
        all.scale: 255
    outs:
    - path: data/processed/casting/tabular/cae_mse.csv
      md5: 5e12ace6ac268a48212c43ad41e922b0
      size: 125146
    - path: visualisation/casting/caemse_hist.png
      md5: 1ce46dfac77134b97ae885f2c860858a
      size: 20951
  merge_complexity_caemse:
    cmd: python3 src/merge_complexity_caemse.py
    deps:
    - path: data/processed/casting/tabular/cae_mse.csv
      md5: 5e12ace6ac268a48212c43ad41e922b0
      size: 125146
    - path: data/processed/casting/tabular/complexity.csv
      md5: 022eb21cb936a10753c6702ed6ced1b7
      size: 148809
    - path: src/merge_complexity_caemse.py
      md5: 6130db19c6c38fcfc7dfc696399861e6
      size: 4667
    - path: src/utils/dvc/params.py
      md5: d87b352ff952b8466547c02182996e48
      size: 1285
    params:
      params.yaml:
        all.dataset: casting
    outs:
    - path: data/processed/casting/tabular/complexity_caemse.csv
      md5: b2fdd620a2170a2f5bc5cc0cc5564e92
      size: 165010
    - path: visualisation/casting/complexity_vs_caemse.html
      md5: 722b817da1bf07604dd4574a1d368417
      size: 108296
  metrify_reconstruction:
    cmd: python3 src/metrify_reconstruction.py
    deps:
    - path: data/processed/casting/tabular/cae_mse.csv
      md5: 5e12ace6ac268a48212c43ad41e922b0
      size: 125146
    - path: src/metrify_reconstruction.py
      md5: eddbca91c34ec528edfbc104f5c2f1f1
      size: 2826
    - path: src/utils/dvc/params.py
      md5: d87b352ff952b8466547c02182996e48
      size: 1285
    outs:
    - path: metrics/casting/reconstruction_data.csv
      md5: 1a04dd6929a0e589b21985cecfd22ad4
      size: 350
    - path: metrics/casting/reconstruction_metrics.json
      md5: 5376336726b174a4147f07ba0078b822
      size: 472
    - path: visualisation/casting/reconstruction_metrics.html
      md5: 28ff113b49bc973d1eaae50d2baa8b40
      size: 3583910
  train_classifier_models:
    cmd: python3 src/train_classifier_models.py
    deps:
    - path: data/processed/casting/tabular/complexity_caemse.csv
      md5: b2fdd620a2170a2f5bc5cc0cc5564e92
      size: 165010
    - path: src/train_classifier_models.py
      md5: abee4fc383d8b75ac0627a85415f567c
      size: 2980
    - path: src/utils/dvc/params.py
      md5: d87b352ff952b8466547c02182996e48
      size: 1285
    - path: src/utils/misc.py
      md5: e29c4af95c5e5d4228701c6303e83b86
      size: 3503
    params:
      params.yaml:
        all.dataset: casting
        train_classifier_models.models_n_iter: 25
        train_classifier_models.models_n_splits: 10
        train_classifier_models.models_score_func: f1
    outs:
    - path: models/casting/bin/logistic_regression_autoencoder.joblib
      md5: 4d13989e859d7447fbe912b11c9aa263
      size: 1259
    - path: models/casting/bin/logistic_regression_combined.joblib
      md5: e425db1e742292d2754e645a3d285101
      size: 1323
    - path: models/casting/bin/logistic_regression_complexity.joblib
      md5: 8eae3a096fa77d3c7d5470ecceea88c1
      size: 1291
  evaluate:
    cmd: python3 src/evaluate.py
    deps:
    - path: data/processed/casting/tabular/cae_mse.csv
      md5: 5e12ace6ac268a48212c43ad41e922b0
      size: 125146
    - path: data/processed/casting/tabular/complexity.csv
      md5: 022eb21cb936a10753c6702ed6ced1b7
      size: 148809
    - path: models/casting/bin/logistic_regression_autoencoder.joblib
      md5: 4d13989e859d7447fbe912b11c9aa263
      size: 1259
    - path: models/casting/bin/logistic_regression_combined.joblib
      md5: e425db1e742292d2754e645a3d285101
      size: 1323
    - path: models/casting/bin/logistic_regression_complexity.joblib
      md5: 8eae3a096fa77d3c7d5470ecceea88c1
      size: 1291
    - path: src/evaluate.py
      md5: 35e5fed71c7f2a923c523c9175596b8f
      size: 3327
    - path: src/utils/dvc/params.py
      md5: d87b352ff952b8466547c02182996e48
      size: 1285
    - path: src/utils/evaluation/classification_metrics.py
      md5: d2e336e71ad47cc7fca0f42b3d9c818d
      size: 990
    outs:
    - path: metrics/casting/autoencoder_metrics.json
      md5: 9386b19f7e5c3542562343731891d49f
      size: 114
    - path: metrics/casting/combined_metrics.json
      md5: 1aa44f985e965c94268a8e16774a250f
      size: 128
    - path: metrics/casting/complexity_metrics.json
      md5: 1aa44f985e965c94268a8e16774a250f
      size: 128
    - path: visualisation/casting/autoencoder_confusion_matrix.png
      md5: 0b59736a9f983e489dee40c83860f40d
      size: 19302
    - path: visualisation/casting/combined_confusion_matrix.png
      md5: 35b3a03c2eceba327cf7605478354479
      size: 18578
    - path: visualisation/casting/complexity_confusion_matrix.png
      md5: 35b3a03c2eceba327cf7605478354479
      size: 18578
