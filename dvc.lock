schema: '2.0'
stages:
  augmentation_visualisation:
    cmd: python3 src/augmentation_visualisation.py
    deps:
    - path: data/processed/train
      md5: fe46cb0152c9cbbcbd9310681d7f1138.dir
      size: 22631897
      nfiles: 909
    - path: src/augmentation_visualisation.py
      md5: 5ecb204dde2b36cf9cf989079ef3e893
      size: 1481
    - path: src/utils/data/tfdatasets.py
      md5: 597721beb3f0e4c2b26645a4bb116335
      size: 6584
    params:
      params.yaml:
        all.input_size:
        - 224
        - 224
        - 1
        all.random_brightness: 0.2
        all.random_contrast: 0.2
        all.random_crop:
        - 224
        - 224
        all.random_flip: horizontal_and_vertical
        all.random_rotation: 0.4
        all.random_translation_height:
        - -0.1
        - 0.1
        all.random_translation_width:
        - -0.1
        - 0.1
        all.random_zoom:
        - -0.1
        - 0.1
    outs:
    - path: visualisation/augmentation/casting_augmented_images.png
      md5: 7bb956d4b11862f45f3a7ad8c7fa461f
      size: 292379
  train_test_split:
    cmd: python3 src/train_test_split.py
    deps:
    - path: data/raw
      md5: 563507493540e6e4d2a729d9c4dd1ba4.dir
      size: 32402506
      nfiles: 1303
    - path: src/train_test_split.py
      md5: cf18f7d8a4ed47630ad1e033ee739a8e
      size: 2934
    - path: src/utils/dvc/params.py
      md5: 29fe2901f8c48bca234c1792cb8c23e8
      size: 836
    params:
      params.yaml:
        train_test_split.seed: 14
        train_test_split.shuffle: true
        train_test_split.split_ratio: 0.8
    outs:
    - path: data/processed/test
      md5: 6eb73943fd549cbb0bee08129c9f17d1.dir
      size: 6472555
      nfiles: 261
    - path: data/processed/train
      md5: c5defe0226b3dfadcf5b347a47a57c32.dir
      size: 25929828
      nfiles: 1039
  extract_complexity:
    cmd: python3 src/extract_complexity.py
    deps:
    - path: data/processed/test
      md5: 19d9cc427bb1e49c1a90516f7c8388b8.dir
      size: 6549295
      nfiles: 261
    - path: data/processed/train
      md5: fe46cb0152c9cbbcbd9310681d7f1138.dir
      size: 22631897
      nfiles: 909
    - path: src/extract_complexity.py
      md5: 5d7f9514b0e9c6050741f9d9e051342d
      size: 1355
    - path: src/utils/data/complexityaux.py
      md5: 0fdd7a277d93e83da136646ac119929c
      size: 3092
    - path: src/utils/data/jpegmse.py
      md5: e342de2355d1636284f6312007774db5
      size: 1737
    outs:
    - path: data/processed/tabular/complexity.csv
      md5: ecda53a6bc784bf7d09ee5cb5ea7907f
      size: 115041
    - path: visualisation/complexity/casting/train_def_front_hist.png
      md5: 90a330d24bc24694d9f96667b1173c8d
      size: 15961
    - path: visualisation/complexity/casting/train_ok_front_hist.png
      md5: caf7700ffc8b8ae42a354892cd94604c
      size: 17457
    - path: visualisation/complexity/casting/val_def_front_hist.png
      md5: a9865dfc48660d396eb1acd7d5994e20
      size: 14415
    - path: visualisation/complexity/casting/val_ok_front_hist.png
      md5: 2021c24b44827ab6a1202ca91d56cd61
      size: 15099
  dataset_split:
    cmd: python3 src/dataset_split.py
    deps:
    - path: data/raw/casting
      md5: b333fcc1e3fbef34d7e404ab1fd8af37.dir
      size: 32402383
      nfiles: 1300
    - path: src/dataset_split.py
      md5: f27ad206b012a1e2c3bab6733adfd210
      size: 2602
    - path: src/utils/data/filemanipulation.py
      md5: d4dcfb77a9553a20eec7937c45b5d001
      size: 1131
    - path: src/utils/data/misc.py
      md5: 21d215adcb439b736c67451c33490895
      size: 783
    params:
      params.yaml:
        all.dataset: casting
        all.seed: 13
        dataset_split.shuffle: true
        dataset_split.split_ratio:
        - 0.7
        - 0.1
        - 0.2
    outs:
    - path: data/processed/casting
      md5: 5d4dc42e9cb08a999b583a51eb5a5366.dir
      size: 32402383
      nfiles: 1300
  cae_hp_tuning:
    cmd: python3 src/cae_hp_tuning.py
    deps:
    - path: data/processed/train
      md5: fe46cb0152c9cbbcbd9310681d7f1138.dir
      size: 22631897
      nfiles: 909
    - path: data/processed/val
      md5: 7e729c4bdd49129f6b3d87cd3d6de671.dir
      size: 3221191
      nfiles: 130
    - path: src/cae_hp_tuning.py
      md5: 7029e176b2e1d3093497bd01b0275c95
      size: 3195
    - path: src/utils/data/tfdatasets.py
      md5: 597721beb3f0e4c2b26645a4bb116335
      size: 6584
    - path: src/utils/models/kerascallbacks.py
      md5: aed55c7bed2011e830726de3a42446e5
      size: 11126
    - path: src/utils/models/ktmodels.py
      md5: c7d52fc396d33dacacfd1822ca178640
      size: 10546
    params:
      params.yaml:
        all.random_brightness: 0.2
        all.random_contrast: 0.2
        all.random_crop:
        - 224
        - 224
        all.random_flip: horizontal_and_vertical
        all.random_rotation: 0.4
        all.random_translation_height:
        - -0.1
        - 0.1
        all.random_translation_width:
        - -0.1
        - 0.1
        all.random_zoom:
        - -0.1
        - 0.1
        cae_hp_tuning.alpha: 0.98
        cae_hp_tuning.batch_size: 4
        cae_hp_tuning.beta: 0.9
        cae_hp_tuning.bottleneck_filters: 64
        cae_hp_tuning.early_stopping: false
        cae_hp_tuning.epochs: 25
        cae_hp_tuning.log_path: models/casting/logs/hp_search
        cae_hp_tuning.max_trials: 50
        cae_hp_tuning.min_lr: 1e-06
        cae_hp_tuning.patience: 3
        cae_hp_tuning.revive_best: true
    outs:
    - path: models/casting/bin/hp_search_best.hdf5
      md5: bb918842e8ee094b2e0cece577913dd4
      size: 1909560
    - path: models/casting/logs/hp_search/CAE
      md5: ee46da96f65324153e7ef95b802210a3.dir
      size: 920846169
      nfiles: 202
    - path: models/casting/logs/hp_search/hp_search_results.txt
      md5: 8cd6e47b3a851bf46afa5c4a78448c0b
      size: 368
    - path: models/casting/logs/hp_search/tb
      md5: f49893714e7f5fa7ed8c8defd79f33f0.dir
      size: 24558533
      nfiles: 150
  visualisation:
    cmd: python3 src/visualisation.py
    deps:
    - path: data/processed/train
      md5: fe46cb0152c9cbbcbd9310681d7f1138.dir
      size: 22631897
      nfiles: 909
    - path: models/best_cae.hdf5
      md5: 731c6664272be9403773f55ecbdd3c84
      size: 6029136
    - path: src/utils/data/tfdatasets.py
      md5: 597721beb3f0e4c2b26645a4bb116335
      size: 6584
    - path: src/utils/dvc/params.py
      md5: 29fe2901f8c48bca234c1792cb8c23e8
      size: 836
    - path: src/visualisation.py
      md5: 13314fa8db8dfdd06486cd4005fae2d3
      size: 2317
    params:
      params.yaml:
        all.random_brightness: 0.2
        all.random_contrast: 0.2
        all.random_crop:
        - 224
        - 224
        all.random_flip: horizontal_and_vertical
        all.random_rotation: 0.4
        all.random_translation_height:
        - -0.1
        - 0.1
        all.random_translation_width:
        - -0.1
        - 0.1
        all.random_zoom:
        - -0.1
        - 0.1
    outs:
    - path: visualisation/augmentation/augmented_images.png
      md5: 544e01a35d2f2e697231aa813deff9da
      size: 289277
    - path: visualisation/reconstruction/reconstructed_images.png
      md5: 66f1cedae454a2075c101b802cbed542
      size: 323819
  cae_training:
    cmd: python3 src/cae_training.py
    deps:
    - path: data/processed/train
      md5: fe46cb0152c9cbbcbd9310681d7f1138.dir
      size: 22631897
      nfiles: 909
    - path: data/processed/val
      md5: 7e729c4bdd49129f6b3d87cd3d6de671.dir
      size: 3221191
      nfiles: 130
    - path: models/casting/bin/pretrained_cae.hdf5
      md5: 376bfd9dc4462eba148771491d66ad13
      size: 5551848
    - path: src/cae_training.py
      md5: 53847d94d26639299ef661bd54fc0765
      size: 3919
    - path: src/utils/data/tfdatasets.py
      md5: 597721beb3f0e4c2b26645a4bb116335
      size: 6584
    - path: src/utils/models/kerascallbacks.py
      md5: aed55c7bed2011e830726de3a42446e5
      size: 11126
    params:
      params.yaml:
        all.random_brightness: 0.2
        all.random_contrast: 0.2
        all.random_crop:
        - 224
        - 224
        all.random_flip: horizontal_and_vertical
        all.random_rotation: 0.4
        all.random_translation_height:
        - -0.1
        - 0.1
        all.random_translation_width:
        - -0.1
        - 0.1
        all.random_zoom:
        - -0.1
        - 0.1
        cae_training.alpha: 0.98
        cae_training.batch_size: 8
        cae_training.beta: 0.9
        cae_training.early_stopping: false
        cae_training.epochs: 2
        cae_training.learning_rate: 0.0005
        cae_training.min_lr: 1e-05
        cae_training.patience: 3
        cae_training.revive_best: true
    outs:
    - path: models/casting/bin/best_cae.hdf5
      md5: 6b9df6103851a224ba0bfe5d05d56bb8
      size: 5551848
    - path: models/casting/logs/training_history.csv
      md5: 55f7c0a2817264a4eb3dae17f626b2df
      size: 296
  calculate_reconstruction_mse:
    cmd: python3 src/calculate_reconstruction_mse.py
    deps:
    - path: data/processed/test
      md5: 19d9cc427bb1e49c1a90516f7c8388b8.dir
      size: 6549295
      nfiles: 261
    - path: data/processed/train
      md5: fe46cb0152c9cbbcbd9310681d7f1138.dir
      size: 22631897
      nfiles: 909
    - path: data/processed/val
      md5: 7e729c4bdd49129f6b3d87cd3d6de671.dir
      size: 3221191
      nfiles: 130
    - path: models/casting/bin/best_cae.hdf5
      md5: 6b9df6103851a224ba0bfe5d05d56bb8
      size: 5551848
    - path: src/calculate_reconstruction_mse.py
      md5: c3cbebcbffc8a7263efe104c5144ac04
      size: 1666
    - path: src/utils/data/complexityaux.py
      md5: 0fdd7a277d93e83da136646ac119929c
      size: 3092
    outs:
    - path: data/processed/tabular/cae_mse.csv
      md5: 0aa061b82e5a1084a1b45c500dc134da
      size: 111489
    - path: visualisation/reconstruction/casting/train_def_front_hist.png
      md5: c66372971081547fa06aa46859a28193
      size: 14340
    - path: visualisation/reconstruction/casting/train_ok_front_hist.png
      md5: babc2247eded2edb0f64a5be964b20c1
      size: 13562
    - path: visualisation/reconstruction/casting/val_def_front_hist.png
      md5: 6c051f0c98a5307453500dd6447d3b3f
      size: 13039
    - path: visualisation/reconstruction/casting/val_ok_front_hist.png
      md5: 5aff4345da4c4db6e6d8a3541143d797
      size: 15414
  reconstruction_visualisation:
    cmd: python3 src/reconstruction_visualisation.py
    deps:
    - path: data/processed/train
      md5: fe46cb0152c9cbbcbd9310681d7f1138.dir
      size: 22631897
      nfiles: 909
    - path: models/casting/bin/best_cae.hdf5
      md5: 6b9df6103851a224ba0bfe5d05d56bb8
      size: 5551848
    - path: src/reconstruction_visualisation.py
      md5: 53d79bde8eb96e36f7777e1697d8b6de
      size: 1305
    - path: src/utils/data/tfdatasets.py
      md5: 597721beb3f0e4c2b26645a4bb116335
      size: 6584
    params:
      params.yaml:
        all.input_size:
        - 224
        - 224
        - 1
    outs:
    - path: visualisation/reconstruction/casting/reconstructed_images.png
      md5: 7072ee3aa0fa13625c458fb47eccbf1e
      size: 323194
  complexity_vs_caemse:
    cmd: python3 src/complexity_vs_caemse.py
    deps:
    - path: data/processed/tabular/cae_mse.csv
      md5: 0aa061b82e5a1084a1b45c500dc134da
      size: 111489
    - path: data/processed/tabular/complexity.csv
      md5: ecda53a6bc784bf7d09ee5cb5ea7907f
      size: 115041
    - path: src/complexity_vs_caemse.py
      md5: cbc1cdd5fedd3b37aa660007526d8ce5
      size: 2078
    outs:
    - path: visualisation/casting_complexity_vs_caemse.html
      md5: 0639e37ae8b0c75f6a126b5d39717733
      size: 3623576
  cae_mse_model:
    cmd: python3 src/cae_mse_model.py
    deps:
    - path: data/processed/tabular/cae_mse.csv
      md5: 0aa061b82e5a1084a1b45c500dc134da
      size: 111489
    - path: src/cae_mse_model.py
      md5: 4ae4d7345887b861d35c2d00632cb5dd
      size: 1989
    - path: src/utils/models/threshold_search.py
      md5: b7a0f3bd52e1b1a40c97f328e9f2dbff
      size: 3572
    params:
      params.yaml:
        cae_mse_model.n_iter: 25
        cae_mse_model.score_func: accuracy
    outs:
    - path: models/casting/params/mse_threshold.txt
      md5: 7b5620487b95cebb3a86535ea3191cf8
      size: 19
    - path: visualisation/thresholds/casting/mse.html
      md5: 5e96a2182540178d8cfbbff38f830ea3
      size: 3586747
  evaluate:
    cmd: python3 src/evaluate.py
    deps:
    - path: data/processed/tabular/cae_mse.csv
      md5: 0aa061b82e5a1084a1b45c500dc134da
      size: 111489
    - path: models/casting/params/corrected_mse_threshold.txt
      md5: c7babf8158e0bb3070b28d5b36d9ae2c
      size: 18
    - path: models/casting/params/mse_threshold.txt
      md5: 7b5620487b95cebb3a86535ea3191cf8
      size: 19
    - path: src/evaluate.py
      md5: a7dd3ecaea1e587a79e4a81d7ebad40f
      size: 3882
    - path: src/utils/evaluation/classification_metrics.py
      md5: 058a9cc1d3d17bd5e8edc4a4bed44243
      size: 699
    outs:
    - path: metrics/casting/cae_metrics.json
      md5: 54aa39c1ea52332d2c03f6dfbc183f45
      size: 372
    - path: metrics/casting/corrected_cae_metrics.json
      md5: 1071307458a74e671381f5ffa0c13c8b
      size: 236
  corrected_model:
    cmd: python3 src/corrected_model.py
    deps:
    - path: data/processed/tabular/cae_mse.csv
      md5: 0aa061b82e5a1084a1b45c500dc134da
      size: 111489
    - path: src/corrected_model.py
      md5: 9d0152a4b049510870242b31780f0653
      size: 2387
    - path: src/utils/models/threshold_search.py
      md5: b7a0f3bd52e1b1a40c97f328e9f2dbff
      size: 3572
    params:
      params.yaml:
        corrected_model.n_iter: 25
        corrected_model.score_func: accuracy
    outs:
    - path: models/casting/params/corrected_mse_threshold.txt
      md5: c7babf8158e0bb3070b28d5b36d9ae2c
      size: 18
    - path: visualisation/thresholds/casting/corrected_mse.html
      md5: 38f0e2986094de6d9d40839633d95712
      size: 3586612
  cae_pretraining:
    cmd: python3 src/cae_pretraining.py
    deps:
    - path: data/raw/tiny-imagenet-200
      md5: 7a16a4c11bed2b39c5d20c304e85355c.dir
      size: 236686390
      nfiles: 120003
    - path: models/casting/bin/hp_search_best.hdf5
      md5: bb918842e8ee094b2e0cece577913dd4
      size: 1909560
    - path: src/cae_pretraining.py
      md5: 5f876ebc33fc123c50974e6bd7231e4f
      size: 3307
    - path: src/utils/data/tfdatasets.py
      md5: 597721beb3f0e4c2b26645a4bb116335
      size: 6584
    - path: src/utils/models/kerascallbacks.py
      md5: aed55c7bed2011e830726de3a42446e5
      size: 11126
    params:
      params.yaml:
        all.random_brightness: 0.2
        all.random_contrast: 0.2
        all.random_crop:
        - 224
        - 224
        all.random_flip: horizontal_and_vertical
        all.random_rotation: 0.4
        all.random_translation_height:
        - -0.1
        - 0.1
        all.random_translation_width:
        - -0.1
        - 0.1
        all.random_zoom:
        - -0.1
        - 0.1
        cae_pretraining.alpha: 0.98
        cae_pretraining.batch_size: 2
        cae_pretraining.beta: 0.9
        cae_pretraining.early_stopping: false
        cae_pretraining.epochs: 2
        cae_pretraining.learning_rate: 0.001
        cae_pretraining.min_lr: 1e-05
        cae_pretraining.patience: 3
        cae_pretraining.revive_best: true
    outs:
    - path: models/casting/bin/pretrained_cae.hdf5
      md5: 376bfd9dc4462eba148771491d66ad13
      size: 5551848
    - path: models/casting/logs/pretraining_history.csv
      md5: cdbb31e26d974a2f4fcf114a9df926b1
      size: 287
