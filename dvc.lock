schema: '2.0'
stages:
  augmentation_visualisation:
    cmd: python3 src/augmentation_visualisation.py
    deps:
    - path: data/processed/train
      md5: fe46cb0152c9cbbcbd9310681d7f1138.dir
      size: 22631897
      nfiles: 909
    - path: src/augmentation_visualisation.py
      md5: 1409ede16ffb154fd6965182ff553271
      size: 1435
    - path: src/utils/data/tfdatasets.py
      md5: 597721beb3f0e4c2b26645a4bb116335
      size: 6584
    - path: src/utils/dvc/params.py
      md5: 29fe2901f8c48bca234c1792cb8c23e8
      size: 836
    params:
      params.yaml:
        all.random_brightness: 0.2
        all.random_contrast: 0.2
        all.random_crop:
        - 224
        - 224
        all.random_flip: horizontal_and_vertical
        all.random_rotation: 0.4
        all.random_translation_height:
        - -0.1
        - 0.1
        all.random_translation_width:
        - -0.1
        - 0.1
        all.random_zoom:
        - -0.1
        - 0.1
    outs:
    - path: visualisation/augmentation/augmented_images.png
      md5: 6f0c9f5aa27f3cc2055c55c8f68fa20e
      size: 298997
  train_test_split:
    cmd: python3 src/train_test_split.py
    deps:
    - path: data/raw
      md5: 563507493540e6e4d2a729d9c4dd1ba4.dir
      size: 32402506
      nfiles: 1303
    - path: src/train_test_split.py
      md5: cf18f7d8a4ed47630ad1e033ee739a8e
      size: 2934
    - path: src/utils/dvc/params.py
      md5: 29fe2901f8c48bca234c1792cb8c23e8
      size: 836
    params:
      params.yaml:
        train_test_split.seed: 14
        train_test_split.shuffle: true
        train_test_split.split_ratio: 0.8
    outs:
    - path: data/processed/test
      md5: 6eb73943fd549cbb0bee08129c9f17d1.dir
      size: 6472555
      nfiles: 261
    - path: data/processed/train
      md5: c5defe0226b3dfadcf5b347a47a57c32.dir
      size: 25929828
      nfiles: 1039
  extract_complexity:
    cmd: python3 src/extract_complexity.py
    deps:
    - path: data/processed/test
      md5: 19d9cc427bb1e49c1a90516f7c8388b8.dir
      size: 6549295
      nfiles: 261
    - path: data/processed/train
      md5: fe46cb0152c9cbbcbd9310681d7f1138.dir
      size: 22631897
      nfiles: 909
    - path: src/extract_complexity.py
      md5: 56ab1c5823fce9ba56b1c50191a842a0
      size: 1334
    - path: src/utils/data/complexityaux.py
      md5: 0fdd7a277d93e83da136646ac119929c
      size: 3092
    - path: src/utils/data/jpegmse.py
      md5: e342de2355d1636284f6312007774db5
      size: 1737
    outs:
    - path: data/processed/tabular/complexity.csv
      md5: ecda53a6bc784bf7d09ee5cb5ea7907f
      size: 115041
    - path: visualisation/complexity/train_def_front_hist.png
      md5: 90a330d24bc24694d9f96667b1173c8d
      size: 15961
    - path: visualisation/complexity/train_ok_front_hist.png
      md5: caf7700ffc8b8ae42a354892cd94604c
      size: 17457
    - path: visualisation/complexity/val_def_front_hist.png
      md5: a9865dfc48660d396eb1acd7d5994e20
      size: 14415
    - path: visualisation/complexity/val_ok_front_hist.png
      md5: 2021c24b44827ab6a1202ca91d56cd61
      size: 15099
  dataset_split:
    cmd: python3 src/dataset_split.py
    deps:
    - path: data/raw
      md5: 563507493540e6e4d2a729d9c4dd1ba4.dir
      size: 32402506
      nfiles: 1303
    - path: src/dataset_split.py
      md5: 0d119dbc2b686445c60ee6a2a9dff6a3
      size: 4199
    - path: src/utils/dvc/params.py
      md5: 29fe2901f8c48bca234c1792cb8c23e8
      size: 836
    params:
      params.yaml:
        all.seed: 13
        dataset_split.shuffle: true
        dataset_split.split_ratio:
        - 0.7
        - 0.1
        - 0.2
    outs:
    - path: data/processed/test
      md5: 19d9cc427bb1e49c1a90516f7c8388b8.dir
      size: 6549295
      nfiles: 261
    - path: data/processed/train
      md5: fe46cb0152c9cbbcbd9310681d7f1138.dir
      size: 22631897
      nfiles: 909
    - path: data/processed/val
      md5: 7e729c4bdd49129f6b3d87cd3d6de671.dir
      size: 3221191
      nfiles: 130
  cae_hp_tuning:
    cmd: python3 src/cae_hp_tuning.py
    deps:
    - path: data/processed/train
      md5: fe46cb0152c9cbbcbd9310681d7f1138.dir
      size: 22631897
      nfiles: 909
    - path: data/processed/val
      md5: 7e729c4bdd49129f6b3d87cd3d6de671.dir
      size: 3221191
      nfiles: 130
    - path: src/cae_hp_tuning.py
      md5: 1b85c8f0572ee0ceea2621a008d74f20
      size: 3198
    - path: src/utils/data/tfdatasets.py
      md5: 597721beb3f0e4c2b26645a4bb116335
      size: 6584
    - path: src/utils/dvc/params.py
      md5: 29fe2901f8c48bca234c1792cb8c23e8
      size: 836
    - path: src/utils/models/kerascallbacks.py
      md5: aed55c7bed2011e830726de3a42446e5
      size: 11126
    - path: src/utils/models/ktmodels.py
      md5: c7d52fc396d33dacacfd1822ca178640
      size: 10546
    params:
      params.yaml:
        all.random_brightness: 0.2
        all.random_contrast: 0.2
        all.random_crop:
        - 224
        - 224
        all.random_flip: horizontal_and_vertical
        all.random_rotation: 0.4
        all.random_translation_height:
        - -0.1
        - 0.1
        all.random_translation_width:
        - -0.1
        - 0.1
        all.random_zoom:
        - -0.1
        - 0.1
        cae_hp_tuning.alpha: 0.98
        cae_hp_tuning.batch_size: 4
        cae_hp_tuning.beta: 0.9
        cae_hp_tuning.bottleneck_filters: 64
        cae_hp_tuning.early_stopping: false
        cae_hp_tuning.epochs: 20
        cae_hp_tuning.log_path: models/logs
        cae_hp_tuning.max_trials: 50
        cae_hp_tuning.min_lr: 1e-05
        cae_hp_tuning.patience: 3
        cae_hp_tuning.revive_best: true
    outs:
    - path: models/logs
      md5: c322b6e3c6d48834fe1e8bba7012e5b3.dir
      size: 845325824
      nfiles: 354
  visualisation:
    cmd: python3 src/visualisation.py
    deps:
    - path: data/processed/train
      md5: fe46cb0152c9cbbcbd9310681d7f1138.dir
      size: 22631897
      nfiles: 909
    - path: models/best_cae.hdf5
      md5: 731c6664272be9403773f55ecbdd3c84
      size: 6029136
    - path: src/utils/data/tfdatasets.py
      md5: 597721beb3f0e4c2b26645a4bb116335
      size: 6584
    - path: src/utils/dvc/params.py
      md5: 29fe2901f8c48bca234c1792cb8c23e8
      size: 836
    - path: src/visualisation.py
      md5: 13314fa8db8dfdd06486cd4005fae2d3
      size: 2317
    params:
      params.yaml:
        all.random_brightness: 0.2
        all.random_contrast: 0.2
        all.random_crop:
        - 224
        - 224
        all.random_flip: horizontal_and_vertical
        all.random_rotation: 0.4
        all.random_translation_height:
        - -0.1
        - 0.1
        all.random_translation_width:
        - -0.1
        - 0.1
        all.random_zoom:
        - -0.1
        - 0.1
    outs:
    - path: visualisation/augmentation/augmented_images.png
      md5: 544e01a35d2f2e697231aa813deff9da
      size: 289277
    - path: visualisation/reconstruction/reconstructed_images.png
      md5: 66f1cedae454a2075c101b802cbed542
      size: 323819
  cae_training:
    cmd: python3 src/cae_training.py
    deps:
    - path: data/processed/train
      md5: fe46cb0152c9cbbcbd9310681d7f1138.dir
      size: 22631897
      nfiles: 909
    - path: data/processed/val
      md5: 7e729c4bdd49129f6b3d87cd3d6de671.dir
      size: 3221191
      nfiles: 130
    - path: models/logs/hp_search_best.hdf5
      md5: aee7a39682816c19aaf469036b7cec0f
      size: 2069552
    - path: src/cae_training.py
      md5: 84ffcd020f14ab3f975fd831df07561a
      size: 3867
    - path: src/utils/data/tfdatasets.py
      md5: 597721beb3f0e4c2b26645a4bb116335
      size: 6584
    - path: src/utils/dvc/params.py
      md5: 29fe2901f8c48bca234c1792cb8c23e8
      size: 836
    - path: src/utils/models/kerascallbacks.py
      md5: aed55c7bed2011e830726de3a42446e5
      size: 11126
    params:
      params.yaml:
        all.random_brightness: 0.2
        all.random_contrast: 0.2
        all.random_crop:
        - 224
        - 224
        all.random_flip: horizontal_and_vertical
        all.random_rotation: 0.4
        all.random_translation_height:
        - -0.1
        - 0.1
        all.random_translation_width:
        - -0.1
        - 0.1
        all.random_zoom:
        - -0.1
        - 0.1
        cae_training.alpha: 0.98
        cae_training.batch_size: 8
        cae_training.beta: 0.9
        cae_training.early_stopping: false
        cae_training.epochs: 75
        cae_training.learning_rate: 0.0001
        cae_training.min_lr: 1e-05
        cae_training.patience: 3
        cae_training.revive_best: true
    outs:
    - path: models/best_cae.hdf5
      md5: 731c6664272be9403773f55ecbdd3c84
      size: 6029136
    - path: models/training_history.csv
      md5: 13ab31c657a1a5a24dda62b2e99fbe8d
      size: 9555
  calculate_reconstruction_mse:
    cmd: python3 src/calculate_reconstruction_mse.py
    deps:
    - path: data/processed/test
      md5: 19d9cc427bb1e49c1a90516f7c8388b8.dir
      size: 6549295
      nfiles: 261
    - path: data/processed/train
      md5: fe46cb0152c9cbbcbd9310681d7f1138.dir
      size: 22631897
      nfiles: 909
    - path: data/processed/val
      md5: 7e729c4bdd49129f6b3d87cd3d6de671.dir
      size: 3221191
      nfiles: 130
    - path: models/best_cae.hdf5
      md5: 731c6664272be9403773f55ecbdd3c84
      size: 6029136
    - path: src/calculate_reconstruction_mse.py
      md5: f7c3844a58e1cb04781f9f8ad361297d
      size: 1633
    - path: src/utils/data/complexityaux.py
      md5: 0fdd7a277d93e83da136646ac119929c
      size: 3092
    outs:
    - path: data/processed/tabular/cae_mse.csv
      md5: 8e3a48a3e4260644fafe30b747228132
      size: 111470
    - path: visualisation/reconstruction/train_def_front_hist.png
      md5: ec8bab1863c261fea9f257904f4ff6e2
      size: 14766
    - path: visualisation/reconstruction/train_ok_front_hist.png
      md5: 4f75085de29e7c9379f3df7e38ae6051
      size: 13700
    - path: visualisation/reconstruction/val_def_front_hist.png
      md5: d8df7d3f933fa0cfdc475ed673593adc
      size: 12749
    - path: visualisation/reconstruction/val_ok_front_hist.png
      md5: c30127f531cc75459eb3eee352ee81f8
      size: 15323
