schema: '2.0'
stages:
  dataset_split:
    cmd: python3 src/dataset_split.py
    deps:
    - path: data/raw/casting
      md5: b333fcc1e3fbef34d7e404ab1fd8af37.dir
      size: 32402383
      nfiles: 1300
    - path: src/dataset_split.py
      md5: fd014d88baab2e5545b402d3fad2fa9b
      size: 2502
    - path: src/utils/dvc/params.py
      md5: d87b352ff952b8466547c02182996e48
      size: 1285
    - path: src/utils/misc.py
      md5: ab4362add47aec072540aab167654b6c
      size: 4339
    params:
      params.yaml:
        all.dataset: casting
        all.seed: 13
        dataset_split.shuffle: true
        dataset_split.split_ratio:
        - 0.8
        - 0.1
        - 0.1
    outs:
    - path: data/processed/casting/test
      md5: d245fc8b63006e526dd4ede868c6a663.dir
      size: 3261243
      nfiles: 132
    - path: data/processed/casting/train
      md5: 1f4833d5d268687f067ae427f9ba5046.dir
      size: 25933889
      nfiles: 1039
    - path: data/processed/casting/val
      md5: 76e2daf77649bf04d10716ce03bf6394.dir
      size: 3207251
      nfiles: 129
  extract_complexity:
    cmd: python3 src/extract_complexity.py
    deps:
    - path: data/processed/casting/test
      md5: d245fc8b63006e526dd4ede868c6a663.dir
      size: 3261243
      nfiles: 132
    - path: data/processed/casting/train
      md5: 1f4833d5d268687f067ae427f9ba5046.dir
      size: 25933889
      nfiles: 1039
    - path: data/processed/casting/val
      md5: 76e2daf77649bf04d10716ce03bf6394.dir
      size: 3207251
      nfiles: 129
    - path: data/raw/general/all
      md5: 4a91d86144efa74d4475c3cdd63cbc76.dir
      size: 3462267
      nfiles: 51
    - path: src/extract_complexity.py
      md5: 39dc13d3439e52b81fad203d3d0db858
      size: 3993
    - path: src/utils/data/complexityaux.py
      md5: 00a8cf627941ec76b0633d67646990f7
      size: 6469
    - path: src/utils/data/jpegmse.py
      md5: c1481f3b211686758e89359e08f6a684
      size: 3846
    - path: src/utils/dvc/params.py
      md5: d87b352ff952b8466547c02182996e48
      size: 1285
    - path: src/utils/misc.py
      md5: ab4362add47aec072540aab167654b6c
      size: 4339
    params:
      params.yaml:
        all.dataset: casting
        all.grayscale: true
        all.scale: 255
    outs:
    - path: data/processed/casting/tabular/complexity.csv
      md5: 022eb21cb936a10753c6702ed6ced1b7
      size: 148809
    - path: visualisation/casting/complexity_hist.png
      md5: f9d243fbe558e1f1ff01faa6f241bcce
      size: 27097
  cae_hp_tuning:
    cmd: python3 src/cae_hp_tuning.py
    deps:
    - path: data/processed/casting/train
      md5: 1f4833d5d268687f067ae427f9ba5046.dir
      size: 25933889
      nfiles: 1039
    - path: data/processed/casting/val
      md5: 76e2daf77649bf04d10716ce03bf6394.dir
      size: 3207251
      nfiles: 129
    - path: src/cae_hp_tuning.py
      md5: 682b5ad7177599409fa073e40258c7cb
      size: 4492
    - path: src/utils/data/tfdatasets.py
      hash: md5
      md5: bda18c623b539027e6fd8ffac75f6918
      size: 6553
    - path: src/utils/dvc/params.py
      md5: d87b352ff952b8466547c02182996e48
      size: 1285
    - path: src/utils/misc.py
      md5: ab4362add47aec072540aab167654b6c
      size: 4339
    - path: src/utils/models/kerasaux.py
      hash: md5
      md5: 6198fa0eb836b5ab1bf6c2008593cdb3
      size: 11768
    - path: src/utils/models/ktmodels.py
      md5: 528c351e8b26654370dbb3697fbdaae7
      size: 10401
    params:
      params.yaml:
        all.dataset: casting
        all.grayscale: true
        all.input_size:
        - 232
        - 232
        - 1
        all.random_brightness: 0.05
        all.random_contrast: 0.05
        all.random_crop:
        - 224
        - 224
        all.random_flip: horizontal_and_vertical
        all.random_rotation: 1
        all.random_translation_height:
        - -0.05
        - 0.05
        all.random_translation_width:
        - -0.05
        - 0.05
        all.random_zoom:
        - -0.05
        - 0.05
        all.scale: 255
        all.seed: 13
        cae_hp_tuning.alpha: 0.98
        cae_hp_tuning.batch_size: 8
        cae_hp_tuning.beta: 0.93
        cae_hp_tuning.bottleneck_filters: 16
        cae_hp_tuning.early_stopping: false
        cae_hp_tuning.epochs: 130
        cae_hp_tuning.max_trials: 100
        cae_hp_tuning.min_lr: 1e-06
        cae_hp_tuning.patience: 5
        cae_hp_tuning.revive_best: true
    outs:
    - path: models/casting/bin/hp_search_best.hdf5
      hash: md5
      md5: a3d4f58986473a9bf9c7a6be9de03018
      size: 4549048
    - path: models/casting/logs/hp_search/CAE
      hash: md5
      md5: 579f2e32dec7615e5aed1d668ad1df6e.dir
      size: 1452354968
      nfiles: 402
    - path: models/casting/logs/hp_search/hp_search_results.json
      hash: md5
      md5: 4b225dc8c58bf462eeed811c269f79af
      size: 2536
    - path: models/casting/logs/hp_search/tb
      hash: md5
      md5: 784dda69a96d9240f01ba24eac1520a6.dir
      size: 60090942
      nfiles: 300
  cae_pretraining:
    cmd: python3 src/cae_pretraining.py
    deps:
    - path: data/raw/tiny-imagenet-200
      md5: 7a16a4c11bed2b39c5d20c304e85355c.dir
      size: 236686390
      nfiles: 120003
    - path: models/casting/bin/hp_search_best.hdf5
      hash: md5
      md5: a3d4f58986473a9bf9c7a6be9de03018
      size: 4549048
    - path: src/cae_pretraining.py
      hash: md5
      md5: c1f6b3a415d8611ddd1780d271472ed7
      size: 4696
    - path: src/utils/data/tfdatasets.py
      hash: md5
      md5: bda18c623b539027e6fd8ffac75f6918
      size: 6553
    - path: src/utils/dvc/params.py
      md5: d87b352ff952b8466547c02182996e48
      size: 1285
    - path: src/utils/misc.py
      md5: ab4362add47aec072540aab167654b6c
      size: 4339
    - path: src/utils/models/kerasaux.py
      hash: md5
      md5: 6198fa0eb836b5ab1bf6c2008593cdb3
      size: 11768
    params:
      params.yaml:
        all.dataset: casting
        all.grayscale: true
        all.input_size:
        - 232
        - 232
        - 1
        all.random_brightness: 0.05
        all.random_contrast: 0.05
        all.random_crop:
        - 224
        - 224
        all.random_flip: horizontal_and_vertical
        all.random_rotation: 1
        all.random_translation_height:
        - -0.05
        - 0.05
        all.random_translation_width:
        - -0.05
        - 0.05
        all.random_zoom:
        - -0.05
        - 0.05
        all.scale: 255
        all.seed: 13
        cae_pretraining.alpha: 0.98
        cae_pretraining.batch_size: 8
        cae_pretraining.beta: 0.93
        cae_pretraining.early_stopping: true
        cae_pretraining.epochs: 2
        cae_pretraining.learning_rate: 0.0015
        cae_pretraining.min_lr: 1e-05
        cae_pretraining.patience: 3
        cae_pretraining.revive_best: false
    outs:
    - path: models/casting/bin/pretrained_cae.hdf5
      hash: md5
      md5: 5bdf9235856ddeab1c1c398fca249927
      size: 13445968
    - path: models/casting/logs/pretraining_history.csv
      md5: bfbd0cff5c59c921e8ff964e432b46f5
      size: 44
  cae_training:
    cmd: python3 src/cae_training.py
    deps:
    - path: data/processed/casting/train
      md5: 1f4833d5d268687f067ae427f9ba5046.dir
      size: 25933889
      nfiles: 1039
    - path: data/processed/casting/val
      md5: 76e2daf77649bf04d10716ce03bf6394.dir
      size: 3207251
      nfiles: 129
    - path: models/casting/bin/pretrained_cae.hdf5
      hash: md5
      md5: 5bdf9235856ddeab1c1c398fca249927
      size: 13445968
    - path: src/cae_training.py
      md5: 675ab5e23dec6e50d5c35619c691cf49
      size: 4467
    - path: src/utils/data/tfdatasets.py
      hash: md5
      md5: bda18c623b539027e6fd8ffac75f6918
      size: 6553
    - path: src/utils/dvc/params.py
      md5: d87b352ff952b8466547c02182996e48
      size: 1285
    - path: src/utils/models/kerasaux.py
      hash: md5
      md5: 6198fa0eb836b5ab1bf6c2008593cdb3
      size: 11768
    params:
      params.yaml:
        all.dataset: casting
        all.grayscale: true
        all.input_size:
        - 232
        - 232
        - 1
        all.random_brightness: 0.05
        all.random_contrast: 0.05
        all.random_crop:
        - 224
        - 224
        all.random_flip: horizontal_and_vertical
        all.random_rotation: 1
        all.random_translation_height:
        - -0.05
        - 0.05
        all.random_translation_width:
        - -0.05
        - 0.05
        all.random_zoom:
        - -0.05
        - 0.05
        all.scale: 255
        all.seed: 13
        cae_training.alpha: 0.98
        cae_training.batch_size: 8
        cae_training.beta: 0.93
        cae_training.early_stopping: false
        cae_training.epochs: 130
        cae_training.min_lr: 1e-05
        cae_training.patience: 5
        cae_training.revive_best: true
    outs:
    - path: models/casting/bin/trained_cae.hdf5
      hash: md5
      md5: 1df40ad80bc011bcbfa047be0d52689a
      size: 13447000
    - path: models/casting/logs/training_history.csv
      hash: md5
      md5: 302ee0c9ec138b7b5c639b02d7e77b2e
      size: 16540
  calculate_reconstruction_mse:
    cmd: python3 src/calculate_reconstruction_mse.py
    deps:
    - path: data/processed/casting/test
      md5: d245fc8b63006e526dd4ede868c6a663.dir
      size: 3261243
      nfiles: 132
    - path: data/processed/casting/train
      md5: 1f4833d5d268687f067ae427f9ba5046.dir
      size: 25933889
      nfiles: 1039
    - path: data/processed/casting/val
      md5: 76e2daf77649bf04d10716ce03bf6394.dir
      size: 3207251
      nfiles: 129
    - path: models/casting/bin/trained_cae.hdf5
      hash: md5
      md5: 1df40ad80bc011bcbfa047be0d52689a
      size: 13447000
    - path: src/calculate_reconstruction_mse.py
      md5: d5635fdf04b657417b6a60b14114deeb
      size: 3254
    - path: src/utils/data/complexityaux.py
      hash: md5
      md5: 4805e19e6a64f429fcaa75006421ecf9
      size: 6467
    - path: src/utils/dvc/params.py
      md5: d87b352ff952b8466547c02182996e48
      size: 1285
    params:
      params.yaml:
        all.dataset: casting
        all.grayscale: true
        all.scale: 255
    outs:
    - path: data/processed/casting/tabular/cae_mse.csv
      hash: md5
      md5: 2c25f8a5e036dddfbde97ffc1b707ab6
      size: 125102
    - path: visualisation/casting/caemse_hist.png
      hash: md5
      md5: 011d929e105c5d79bf8b0f7747e640c1
      size: 20872
  merge_complexity_caemse:
    cmd: python3 src/merge_complexity_caemse.py
    deps:
    - path: data/processed/casting/tabular/cae_mse.csv
      hash: md5
      md5: 2c25f8a5e036dddfbde97ffc1b707ab6
      size: 125102
    - path: data/processed/casting/tabular/complexity.csv
      md5: 022eb21cb936a10753c6702ed6ced1b7
      size: 148809
    - path: src/merge_complexity_caemse.py
      md5: 6130db19c6c38fcfc7dfc696399861e6
      size: 4667
    - path: src/utils/dvc/params.py
      md5: d87b352ff952b8466547c02182996e48
      size: 1285
    params:
      params.yaml:
        all.dataset: casting
    outs:
    - path: data/processed/casting/tabular/complexity_caemse.csv
      hash: md5
      md5: 74a5a9ac008ed6ac0c89e723316c0a66
      size: 165003
    - path: visualisation/casting/complexity_vs_caemse.html
      hash: md5
      md5: b6537daa1dab4379fd2dea03723ec393
      size: 108282
  metrify_reconstruction:
    cmd: python3 src/metrify_reconstruction.py
    deps:
    - path: data/processed/casting/tabular/cae_mse.csv
      hash: md5
      md5: 2c25f8a5e036dddfbde97ffc1b707ab6
      size: 125102
    - path: src/metrify_reconstruction.py
      hash: md5
      md5: d5fcb16085c1306645c72c35416e2ee2
      size: 3504
    - path: src/utils/dvc/params.py
      md5: d87b352ff952b8466547c02182996e48
      size: 1285
    outs:
    - path: metrics/casting/reconstruction_data.csv
      hash: md5
      md5: 9ac82259fdf1b7c444c75160d9dead0c
      size: 478
    - path: metrics/casting/reconstruction_metrics.json
      hash: md5
      md5: 20ed966f0ab5ec5c7de9e4de25a644ec
      size: 678
    - path: visualisation/casting/reconstruction_metrics.html
      hash: md5
      md5: 09ce5bd4e1dce862e7a401d1e888d5b8
      size: 3584173
  train_classifier_models:
    cmd: python3 src/train_classifier_models.py
    deps:
    - path: data/processed/casting/tabular/complexity_caemse.csv
      hash: md5
      md5: 74a5a9ac008ed6ac0c89e723316c0a66
      size: 165003
    - path: src/train_classifier_models.py
      md5: abee4fc383d8b75ac0627a85415f567c
      size: 2980
    - path: src/utils/dvc/params.py
      md5: d87b352ff952b8466547c02182996e48
      size: 1285
    - path: src/utils/misc.py
      md5: ab4362add47aec072540aab167654b6c
      size: 4339
    params:
      params.yaml:
        all.dataset: casting
        train_classifier_models.models_n_iter: 25
        train_classifier_models.models_n_splits: 10
        train_classifier_models.models_score_func: f1
    outs:
    - path: models/casting/bin/logistic_regression_autoencoder.joblib
      hash: md5
      md5: a156fc4494b1bab34f36ed05aa125492
      size: 1259
    - path: models/casting/bin/logistic_regression_combined.joblib
      hash: md5
      md5: 90f82c68392603c46327bdc663c8f309
      size: 1323
    - path: models/casting/bin/logistic_regression_complexity.joblib
      md5: 8eae3a096fa77d3c7d5470ecceea88c1
      size: 1291
  evaluate:
    cmd: python3 src/evaluate.py
    deps:
    - path: data/processed/casting/tabular/cae_mse.csv
      hash: md5
      md5: 2c25f8a5e036dddfbde97ffc1b707ab6
      size: 125102
    - path: data/processed/casting/tabular/complexity.csv
      md5: 022eb21cb936a10753c6702ed6ced1b7
      size: 148809
    - path: models/casting/bin/logistic_regression_autoencoder.joblib
      hash: md5
      md5: a156fc4494b1bab34f36ed05aa125492
      size: 1259
    - path: models/casting/bin/logistic_regression_combined.joblib
      hash: md5
      md5: 90f82c68392603c46327bdc663c8f309
      size: 1323
    - path: models/casting/bin/logistic_regression_complexity.joblib
      md5: 8eae3a096fa77d3c7d5470ecceea88c1
      size: 1291
    - path: src/evaluate.py
      md5: 35e5fed71c7f2a923c523c9175596b8f
      size: 3327
    - path: src/utils/dvc/params.py
      md5: d87b352ff952b8466547c02182996e48
      size: 1285
    - path: src/utils/evaluation/classification_metrics.py
      md5: d2e336e71ad47cc7fca0f42b3d9c818d
      size: 990
    outs:
    - path: metrics/casting/autoencoder_metrics.json
      md5: 9386b19f7e5c3542562343731891d49f
      size: 114
    - path: metrics/casting/combined_metrics.json
      md5: 1aa44f985e965c94268a8e16774a250f
      size: 128
    - path: metrics/casting/complexity_metrics.json
      md5: 1aa44f985e965c94268a8e16774a250f
      size: 128
    - path: visualisation/casting/autoencoder_confusion_matrix.png
      md5: 0b59736a9f983e489dee40c83860f40d
      size: 19302
    - path: visualisation/casting/combined_confusion_matrix.png
      md5: 35b3a03c2eceba327cf7605478354479
      size: 18578
    - path: visualisation/casting/complexity_confusion_matrix.png
      md5: 35b3a03c2eceba327cf7605478354479
      size: 18578
