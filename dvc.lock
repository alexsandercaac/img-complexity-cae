schema: '2.0'
stages:
  augmentation_visualisation:
    cmd: python3 src/augmentation_visualisation.py
    deps:
    - path: data/processed/train
      md5: fe46cb0152c9cbbcbd9310681d7f1138.dir
      size: 22631897
      nfiles: 909
    - path: src/augmentation_visualisation.py
      md5: 5ecb204dde2b36cf9cf989079ef3e893
      size: 1481
    - path: src/utils/data/tfdatasets.py
      md5: 597721beb3f0e4c2b26645a4bb116335
      size: 6584
    params:
      params.yaml:
        all.input_size:
        - 224
        - 224
        - 1
        all.random_brightness: 0.2
        all.random_contrast: 0.2
        all.random_crop:
        - 224
        - 224
        all.random_flip: horizontal_and_vertical
        all.random_rotation: 0.4
        all.random_translation_height:
        - -0.1
        - 0.1
        all.random_translation_width:
        - -0.1
        - 0.1
        all.random_zoom:
        - -0.1
        - 0.1
    outs:
    - path: visualisation/augmentation/casting_augmented_images.png
      md5: 7bb956d4b11862f45f3a7ad8c7fa461f
      size: 292379
  train_test_split:
    cmd: python3 src/train_test_split.py
    deps:
    - path: data/raw
      md5: 563507493540e6e4d2a729d9c4dd1ba4.dir
      size: 32402506
      nfiles: 1303
    - path: src/train_test_split.py
      md5: cf18f7d8a4ed47630ad1e033ee739a8e
      size: 2934
    - path: src/utils/dvc/params.py
      md5: 29fe2901f8c48bca234c1792cb8c23e8
      size: 836
    params:
      params.yaml:
        train_test_split.seed: 14
        train_test_split.shuffle: true
        train_test_split.split_ratio: 0.8
    outs:
    - path: data/processed/test
      md5: 6eb73943fd549cbb0bee08129c9f17d1.dir
      size: 6472555
      nfiles: 261
    - path: data/processed/train
      md5: c5defe0226b3dfadcf5b347a47a57c32.dir
      size: 25929828
      nfiles: 1039
  extract_complexity:
    cmd: python3 src/extract_complexity.py
    deps:
    - path: data/processed/streets/test
      md5: 8737307fda41b41e1e57ff9650387aef.dir
      size: 4276585
      nfiles: 59
    - path: data/processed/streets/train
      md5: a96c5200e5eb9bc7af4d4ab2155e2ad4.dir
      size: 30376822
      nfiles: 454
    - path: data/processed/streets/val
      md5: 4cf7b450308b4031cc8f2a79380b5ee0.dir
      size: 3461454
      nfiles: 56
    - path: src/extract_complexity.py
      md5: 28790520eb6406c4aa7edac0d863f4f8
      size: 2873
    - path: src/utils/data/complexityaux.py
      md5: c9fb812b32f9aeeacfef342bb1296d95
      size: 3086
    - path: src/utils/data/jpegmse.py
      md5: e342de2355d1636284f6312007774db5
      size: 1737
    - path: src/utils/dvc/params.py
      md5: c57ff0542069d8b6236b09e7aee32be8
      size: 1268
    - path: src/utils/misc.py
      md5: e29c4af95c5e5d4228701c6303e83b86
      size: 3503
    params:
      params.yaml:
        all.dataset: streets
        all.grayscale: false
        all.scale: 255
    outs:
    - path: data/processed/streets/tabular/complexity.csv
      md5: 90e996654f2c0b5f51b43729a009cfa5
      size: 917980
    - path: visualisation/streets/complexity_hist.png
      md5: f6d0dfd60b55b99544eacb0493b85e93
      size: 21078
  dataset_split:
    cmd: python3 src/dataset_split.py
    deps:
    - path: data/raw/streets
      md5: abbd03a5905276626a644e8d176e274b.dir
      size: 38115409
      nfiles: 570
    - path: src/dataset_split.py
      md5: fd43a20218ff832aedd35d7e7dd988bb
      size: 2502
    - path: src/utils/dvc/params.py
      md5: c57ff0542069d8b6236b09e7aee32be8
      size: 1268
    - path: src/utils/misc.py
      md5: e29c4af95c5e5d4228701c6303e83b86
      size: 3503
    params:
      params.yaml:
        all.dataset: streets
        all.seed: 13
        dataset_split.shuffle: true
        dataset_split.split_ratio:
        - 0.8
        - 0.1
        - 0.1
    outs:
    - path: data/processed/streets/test
      md5: 8737307fda41b41e1e57ff9650387aef.dir
      size: 4276585
      nfiles: 59
    - path: data/processed/streets/train
      md5: a96c5200e5eb9bc7af4d4ab2155e2ad4.dir
      size: 30376822
      nfiles: 454
    - path: data/processed/streets/val
      md5: 4cf7b450308b4031cc8f2a79380b5ee0.dir
      size: 3461454
      nfiles: 56
  cae_hp_tuning:
    cmd: python3 src/cae_hp_tuning.py
    deps:
    - path: data/processed/streets/train
      md5: a96c5200e5eb9bc7af4d4ab2155e2ad4.dir
      size: 30376822
      nfiles: 454
    - path: data/processed/streets/val
      md5: 4cf7b450308b4031cc8f2a79380b5ee0.dir
      size: 3461454
      nfiles: 56
    - path: src/cae_hp_tuning.py
      md5: 948c38992d703fa2b4e89cc6a4cbcfaa
      size: 4380
    - path: src/utils/data/tfdatasets.py
      md5: 6d886d24705a0b39ce24c4f9f1076529
      size: 6588
    - path: src/utils/dvc/params.py
      md5: c57ff0542069d8b6236b09e7aee32be8
      size: 1268
    - path: src/utils/misc.py
      md5: e29c4af95c5e5d4228701c6303e83b86
      size: 3503
    - path: src/utils/models/kerasaux.py
      md5: 254eadd4c77e4afca36f020eb569d754
      size: 11749
    - path: src/utils/models/ktmodels.py
      md5: c7d52fc396d33dacacfd1822ca178640
      size: 10546
    params:
      params.yaml:
        all.dataset: streets
        all.grayscale: false
        all.input_size:
        - 256
        - 256
        - 3
        all.random_brightness: 0.2
        all.random_contrast: 0.2
        all.random_crop:
        - 224
        - 224
        all.random_flip: horizontal
        all.random_rotation: 0
        all.random_translation_height:
        - -0.1
        - 0.1
        all.random_translation_width:
        - -0.1
        - 0.1
        all.random_zoom:
        - -0.1
        - 0.1
        all.scale: 255
        all.seed: 13
        cae_hp_tuning.alpha: 0.98
        cae_hp_tuning.batch_size: 8
        cae_hp_tuning.beta: 0.9
        cae_hp_tuning.bottleneck_filters: 8
        cae_hp_tuning.early_stopping: false
        cae_hp_tuning.epochs: 15
        cae_hp_tuning.max_trials: 30
        cae_hp_tuning.min_lr: 1e-06
        cae_hp_tuning.patience: 3
        cae_hp_tuning.revive_best: true
    outs:
    - path: models/streets/bin/hp_search_best.hdf5
      hash: md5
      md5: 3dce453ce711a8fc5909c48fc092c834
      size: 3404680
    - path: models/streets/logs/hp_search/CAE
      hash: md5
      md5: 364d9978293b01f2cdb75c9aafd025c7.dir
      size: 425462313
      nfiles: 122
    - path: models/streets/logs/hp_search/hp_search_results.txt
      hash: md5
      md5: 9abe7765c067ea7d39c2e14b73f31f38
      size: 2339
    - path: models/streets/logs/hp_search/tb
      hash: md5
      md5: 3ba0d3d449d35cf22b5cd2eb4e0b4b15.dir
      size: 14742377
      nfiles: 90
  visualisation:
    cmd: python3 src/visualisation.py
    deps:
    - path: data/processed/train
      md5: fe46cb0152c9cbbcbd9310681d7f1138.dir
      size: 22631897
      nfiles: 909
    - path: models/best_cae.hdf5
      md5: 731c6664272be9403773f55ecbdd3c84
      size: 6029136
    - path: src/utils/data/tfdatasets.py
      md5: 597721beb3f0e4c2b26645a4bb116335
      size: 6584
    - path: src/utils/dvc/params.py
      md5: 29fe2901f8c48bca234c1792cb8c23e8
      size: 836
    - path: src/visualisation.py
      md5: 13314fa8db8dfdd06486cd4005fae2d3
      size: 2317
    params:
      params.yaml:
        all.random_brightness: 0.2
        all.random_contrast: 0.2
        all.random_crop:
        - 224
        - 224
        all.random_flip: horizontal_and_vertical
        all.random_rotation: 0.4
        all.random_translation_height:
        - -0.1
        - 0.1
        all.random_translation_width:
        - -0.1
        - 0.1
        all.random_zoom:
        - -0.1
        - 0.1
    outs:
    - path: visualisation/augmentation/augmented_images.png
      md5: 544e01a35d2f2e697231aa813deff9da
      size: 289277
    - path: visualisation/reconstruction/reconstructed_images.png
      md5: 66f1cedae454a2075c101b802cbed542
      size: 323819
  cae_training:
    cmd: python3 src/cae_training.py
    deps:
    - path: data/processed/streets/train
      md5: a96c5200e5eb9bc7af4d4ab2155e2ad4.dir
      size: 30376822
      nfiles: 454
    - path: data/processed/streets/val
      md5: 4cf7b450308b4031cc8f2a79380b5ee0.dir
      size: 3461454
      nfiles: 56
    - path: models/streets/bin/pretrained_cae.hdf5
      hash: md5
      md5: 8a49dad0463414e76b4ec380d2afe69b
      size: 10004160
    - path: src/cae_training.py
      md5: 491ddf5b491f193c66f00eaac20f0326
      size: 4249
    - path: src/utils/data/tfdatasets.py
      md5: 6d886d24705a0b39ce24c4f9f1076529
      size: 6588
    - path: src/utils/dvc/params.py
      md5: c57ff0542069d8b6236b09e7aee32be8
      size: 1268
    - path: src/utils/models/kerasaux.py
      md5: 254eadd4c77e4afca36f020eb569d754
      size: 11749
    params:
      params.yaml:
        all.dataset: streets
        all.grayscale: false
        all.input_size:
        - 256
        - 256
        - 3
        all.random_brightness: 0.2
        all.random_contrast: 0.2
        all.random_crop:
        - 224
        - 224
        all.random_flip: horizontal
        all.random_rotation: 0
        all.random_translation_height:
        - -0.1
        - 0.1
        all.random_translation_width:
        - -0.1
        - 0.1
        all.random_zoom:
        - -0.1
        - 0.1
        all.scale: 255
        all.seed: 13
        cae_training.alpha: 0.98
        cae_training.batch_size: 8
        cae_training.beta: 0.9
        cae_training.early_stopping: false
        cae_training.epochs: 100
        cae_training.learning_rate: 0.0005
        cae_training.min_lr: 1e-05
        cae_training.patience: 3
        cae_training.revive_best: true
    outs:
    - path: models/streets/bin/trained_cae.hdf5
      hash: md5
      md5: 81ed024e410fb735acef772150179421
      size: 10004160
    - path: models/streets/logs/training_history.csv
      hash: md5
      md5: 491430e7a13e9a294856a85ba1a33337
      size: 12718
  calculate_reconstruction_mse:
    cmd: python3 src/calculate_reconstruction_mse.py
    deps:
    - path: data/processed/streets/test
      md5: 8737307fda41b41e1e57ff9650387aef.dir
      size: 4276585
      nfiles: 59
    - path: data/processed/streets/train
      md5: a96c5200e5eb9bc7af4d4ab2155e2ad4.dir
      size: 30376822
      nfiles: 454
    - path: data/processed/streets/val
      md5: 4cf7b450308b4031cc8f2a79380b5ee0.dir
      size: 3461454
      nfiles: 56
    - path: models/streets/bin/trained_cae.hdf5
      hash: md5
      md5: 81ed024e410fb735acef772150179421
      size: 10004160
    - path: src/calculate_reconstruction_mse.py
      md5: b6a90a2082be79f82b04455703737631
      size: 3275
    - path: src/utils/data/complexityaux.py
      md5: c9fb812b32f9aeeacfef342bb1296d95
      size: 3086
    - path: src/utils/dvc/params.py
      md5: c57ff0542069d8b6236b09e7aee32be8
      size: 1268
    params:
      params.yaml:
        all.dataset: streets
        all.grayscale: false
        all.scale: 255
    outs:
    - path: data/processed/streets/tabular/cae_mse.csv
      hash: md5
      md5: e3c718153c376e458257938863667340
      size: 913213
    - path: visualisation/streets/caemse_hist.png
      hash: md5
      md5: 9e791f49c624917e2fb834f9824afce2
      size: 20620
  reconstruction_visualisation:
    cmd: python3 src/reconstruction_visualisation.py
    deps:
    - path: data/processed/train
      md5: fe46cb0152c9cbbcbd9310681d7f1138.dir
      size: 22631897
      nfiles: 909
    - path: models/casting/bin/best_cae.hdf5
      md5: 6b9df6103851a224ba0bfe5d05d56bb8
      size: 5551848
    - path: src/reconstruction_visualisation.py
      md5: 53d79bde8eb96e36f7777e1697d8b6de
      size: 1305
    - path: src/utils/data/tfdatasets.py
      md5: 597721beb3f0e4c2b26645a4bb116335
      size: 6584
    params:
      params.yaml:
        all.input_size:
        - 224
        - 224
        - 1
    outs:
    - path: visualisation/reconstruction/casting/reconstructed_images.png
      md5: 7072ee3aa0fa13625c458fb47eccbf1e
      size: 323194
  complexity_vs_caemse:
    cmd: python3 src/complexity_vs_caemse.py
    deps:
    - path: data/processed/streets/tabular/cae_mse.csv
      hash: md5
      md5: e3c718153c376e458257938863667340
      size: 913213
    - path: data/processed/streets/tabular/complexity.csv
      md5: 90e996654f2c0b5f51b43729a009cfa5
      size: 917980
    - path: src/complexity_vs_caemse.py
      md5: b24e7f6cf9661963f48002a73b9b4f93
      size: 2863
    - path: src/utils/dvc/params.py
      md5: c57ff0542069d8b6236b09e7aee32be8
      size: 1268
    params:
      params.yaml:
        all.dataset: streets
    outs:
    - path: visualisation/streets/complexity_vs_caemse.html
      hash: md5
      md5: 193c2443ac6beb3c4a7df7019a77a77f
      size: 4015658
  cae_mse_model:
    cmd: python3 src/cae_mse_model.py
    deps:
    - path: data/processed/streets/tabular/cae_mse.csv
      hash: md5
      md5: e3c718153c376e458257938863667340
      size: 913213
    - path: src/cae_mse_model.py
      md5: 8aeb8ee3b69f08e786707ba7167b36f0
      size: 2263
    - path: src/utils/dvc/params.py
      md5: c57ff0542069d8b6236b09e7aee32be8
      size: 1268
    - path: src/utils/misc.py
      md5: e29c4af95c5e5d4228701c6303e83b86
      size: 3503
    - path: src/utils/models/threshold_search.py
      md5: b7a0f3bd52e1b1a40c97f328e9f2dbff
      size: 3572
    params:
      params.yaml:
        all.dataset: streets
        cae_mse_model.balanced: false
        cae_mse_model.n_iter: 25
        cae_mse_model.score_func: f1
    outs:
    - path: models/streets/params/mse_threshold.txt
      hash: md5
      md5: 54e6aec7f8528f6cb6ccf35da4be2b23
      size: 21
    - path: visualisation/streets/mse.html
      hash: md5
      md5: fc40abbd8e409c7a6f3e4196ed6bb441
      size: 3585338
  evaluate:
    cmd: python3 src/evaluate.py
    deps:
    - path: data/processed/streets/tabular/cae_mse.csv
      hash: md5
      md5: e3c718153c376e458257938863667340
      size: 913213
    - path: models/streets/params/corrected_mse_threshold.txt
      hash: md5
      md5: 7c8fccbc8041859e028afea0cc01e60c
      size: 17
    - path: models/streets/params/mse_threshold.txt
      hash: md5
      md5: 54e6aec7f8528f6cb6ccf35da4be2b23
      size: 21
    - path: src/evaluate.py
      md5: 4ba3c9794aeb8ef456f3ba5ef0ca2883
      size: 4297
    - path: src/utils/dvc/params.py
      md5: c57ff0542069d8b6236b09e7aee32be8
      size: 1268
    - path: src/utils/evaluation/classification_metrics.py
      md5: b91b008cdb407c438b390291881baea4
      size: 893
    outs:
    - path: metrics/streets/cae_metrics.json
      hash: md5
      md5: b6cc5dd374679fa07aaef48eedc5091d
      size: 345
    - path: metrics/streets/corrected_cae_metrics.json
      md5: d83759b2b2333a5709de30419d702dfd
      size: 249
  corrected_model:
    cmd: python3 src/corrected_model.py
    deps:
    - path: data/processed/streets/tabular/cae_mse.csv
      hash: md5
      md5: e3c718153c376e458257938863667340
      size: 913213
    - path: data/processed/streets/tabular/complexity.csv
      md5: 90e996654f2c0b5f51b43729a009cfa5
      size: 917980
    - path: src/corrected_model.py
      md5: 527530fc447b3086f3586fe9b1b54f57
      size: 2655
    - path: src/utils/dvc/params.py
      md5: c57ff0542069d8b6236b09e7aee32be8
      size: 1268
    - path: src/utils/misc.py
      md5: e29c4af95c5e5d4228701c6303e83b86
      size: 3503
    - path: src/utils/models/threshold_search.py
      md5: b7a0f3bd52e1b1a40c97f328e9f2dbff
      size: 3572
    params:
      params.yaml:
        all.dataset: streets
        corrected_model.balanced: false
        corrected_model.n_iter: 25
        corrected_model.score_func: f1
    outs:
    - path: models/streets/params/corrected_mse_threshold.txt
      hash: md5
      md5: 7c8fccbc8041859e028afea0cc01e60c
      size: 17
    - path: visualisation/streets/corrected_mse.html
      hash: md5
      md5: d77d2457fa4cce746ea250a0bba179cb
      size: 3585286
  cae_pretraining:
    cmd: python3 src/cae_pretraining.py
    deps:
    - path: data/raw/tiny-imagenet-200
      md5: 7a16a4c11bed2b39c5d20c304e85355c.dir
      size: 236686390
      nfiles: 120003
    - path: models/streets/bin/hp_search_best.hdf5
      hash: md5
      md5: 3dce453ce711a8fc5909c48fc092c834
      size: 3404680
    - path: src/cae_pretraining.py
      md5: 23ce2b41b813f5cc19d47b81fd3afd8e
      size: 4060
    - path: src/utils/data/tfdatasets.py
      md5: 6d886d24705a0b39ce24c4f9f1076529
      size: 6588
    - path: src/utils/dvc/params.py
      md5: c57ff0542069d8b6236b09e7aee32be8
      size: 1268
    - path: src/utils/misc.py
      md5: e29c4af95c5e5d4228701c6303e83b86
      size: 3503
    - path: src/utils/models/kerasaux.py
      md5: 254eadd4c77e4afca36f020eb569d754
      size: 11749
    params:
      params.yaml:
        all.dataset: streets
        all.grayscale: false
        all.input_size:
        - 256
        - 256
        - 3
        all.random_brightness: 0.2
        all.random_contrast: 0.2
        all.random_crop:
        - 224
        - 224
        all.random_flip: horizontal
        all.random_rotation: 0
        all.random_translation_height:
        - -0.1
        - 0.1
        all.random_translation_width:
        - -0.1
        - 0.1
        all.random_zoom:
        - -0.1
        - 0.1
        all.scale: 255
        all.seed: 13
        cae_pretraining.alpha: 0.98
        cae_pretraining.batch_size: 8
        cae_pretraining.beta: 0.9
        cae_pretraining.early_stopping: false
        cae_pretraining.epochs: 10
        cae_pretraining.learning_rate: 0.001
        cae_pretraining.min_lr: 1e-05
        cae_pretraining.patience: 3
        cae_pretraining.revive_best: true
    outs:
    - path: models/streets/bin/pretrained_cae.hdf5
      hash: md5
      md5: 8a49dad0463414e76b4ec380d2afe69b
      size: 10004160
    - path: models/streets/logs/pretraining_history.csv
      hash: md5
      md5: 160e2be4f7d680fa2ee0013db1d76860
      size: 1303
  metrify:
    cmd: python3 src/metrify.py
    deps:
    - path: metrics/streets
      hash: md5
      md5: f22b5df3609b19b05e4131dc2492db9a.dir
      size: 600
      nfiles: 3
    - path: src/metrify.py
      md5: 3d08853cc94e47af19fa489b63bd13cd
      size: 926
    outs:
    - path: metrics/metrics.json
      hash: md5
      md5: ecbf6498d50fab9ad674aa7c0de83ecb
      size: 666
