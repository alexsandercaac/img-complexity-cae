schema: '2.0'
stages:
  dataset_split:
    cmd: python3 src/dataset_split.py
    deps:
    - path: data/raw/casting
      md5: b333fcc1e3fbef34d7e404ab1fd8af37.dir
      size: 32402383
      nfiles: 1300
    - path: src/dataset_split.py
      md5: fd014d88baab2e5545b402d3fad2fa9b
      size: 2502
    - path: src/utils/dvc/params.py
      md5: d87b352ff952b8466547c02182996e48
      size: 1285
    - path: src/utils/misc.py
      md5: ab4362add47aec072540aab167654b6c
      size: 4339
    params:
      params.yaml:
        all.dataset: casting
        all.seed: 13
        dataset_split.shuffle: true
        dataset_split.split_ratio:
        - 0.8
        - 0.1
        - 0.1
    outs:
    - path: data/processed/casting/test
      md5: d245fc8b63006e526dd4ede868c6a663.dir
      size: 3261243
      nfiles: 132
    - path: data/processed/casting/train
      md5: 1f4833d5d268687f067ae427f9ba5046.dir
      size: 25933889
      nfiles: 1039
    - path: data/processed/casting/val
      md5: 76e2daf77649bf04d10716ce03bf6394.dir
      size: 3207251
      nfiles: 129
  extract_complexity:
    cmd: python3 src/extract_complexity.py
    deps:
    - path: data/processed/casting/test
      md5: d245fc8b63006e526dd4ede868c6a663.dir
      size: 3261243
      nfiles: 132
    - path: data/processed/casting/train
      md5: 1f4833d5d268687f067ae427f9ba5046.dir
      size: 25933889
      nfiles: 1039
    - path: data/processed/casting/val
      md5: 76e2daf77649bf04d10716ce03bf6394.dir
      size: 3207251
      nfiles: 129
    - path: data/raw/general/all
      md5: 4a91d86144efa74d4475c3cdd63cbc76.dir
      size: 3462267
      nfiles: 51
    - path: src/extract_complexity.py
      md5: 39dc13d3439e52b81fad203d3d0db858
      size: 3993
    - path: src/utils/data/complexityaux.py
      md5: 00a8cf627941ec76b0633d67646990f7
      size: 6469
    - path: src/utils/data/jpegmse.py
      md5: c1481f3b211686758e89359e08f6a684
      size: 3846
    - path: src/utils/dvc/params.py
      md5: d87b352ff952b8466547c02182996e48
      size: 1285
    - path: src/utils/misc.py
      md5: ab4362add47aec072540aab167654b6c
      size: 4339
    params:
      params.yaml:
        all.dataset: casting
        all.grayscale: true
        all.scale: 255
    outs:
    - path: data/processed/casting/tabular/complexity.csv
      md5: 022eb21cb936a10753c6702ed6ced1b7
      size: 148809
    - path: visualisation/casting/complexity_hist.png
      md5: f9d243fbe558e1f1ff01faa6f241bcce
      size: 27097
  cae_hp_tuning:
    cmd: python3 src/cae_hp_tuning.py
    deps:
    - path: data/processed/casting/train
      md5: 1f4833d5d268687f067ae427f9ba5046.dir
      size: 25933889
      nfiles: 1039
    - path: data/processed/casting/val
      md5: 76e2daf77649bf04d10716ce03bf6394.dir
      size: 3207251
      nfiles: 129
    - path: src/cae_hp_tuning.py
      md5: 682b5ad7177599409fa073e40258c7cb
      size: 4492
    - path: src/utils/data/tfdatasets.py
      md5: c7d7d9a5829e73694eb2e4c3a2a0adaa
      size: 6557
    - path: src/utils/dvc/params.py
      md5: d87b352ff952b8466547c02182996e48
      size: 1285
    - path: src/utils/misc.py
      md5: ab4362add47aec072540aab167654b6c
      size: 4339
    - path: src/utils/models/kerasaux.py
      md5: b505bbc88bdc0d5b68197a2468e34a7e
      size: 11747
    - path: src/utils/models/ktmodels.py
      md5: 528c351e8b26654370dbb3697fbdaae7
      size: 10401
    params:
      params.yaml:
        all.dataset: casting
        all.grayscale: true
        all.input_size:
        - 232
        - 232
        - 1
        all.random_brightness: 0.05
        all.random_contrast: 0.05
        all.random_crop:
        - 224
        - 224
        all.random_flip: horizontal_and_vertical
        all.random_rotation: 1
        all.random_translation_height:
        - -0.05
        - 0.05
        all.random_translation_width:
        - -0.05
        - 0.05
        all.random_zoom:
        - -0.05
        - 0.05
        all.scale: 255
        all.seed: 13
        cae_hp_tuning.alpha: 0.98
        cae_hp_tuning.batch_size: 8
        cae_hp_tuning.beta: 0.93
        cae_hp_tuning.bottleneck_filters: 32
        cae_hp_tuning.early_stopping: false
        cae_hp_tuning.epochs: 130
        cae_hp_tuning.max_trials: 100
        cae_hp_tuning.min_lr: 1e-06
        cae_hp_tuning.patience: 5
        cae_hp_tuning.revive_best: true
    outs:
    - path: models/casting/bin/hp_search_best.hdf5
      md5: f2725b3b2445bf2d6928acd8b0e180c7
      size: 6864888
    - path: models/casting/logs/hp_search/CAE
      md5: 0ee39c531dfbf762f8106285ccc56a04.dir
      size: 1547869444
      nfiles: 396
    - path: models/casting/logs/hp_search/hp_search_results.json
      md5: 2c8033b5c980971d3639deb81a3c29bb
      size: 2536
    - path: models/casting/logs/hp_search/tb
      md5: 7f80ecca4da9ea52ff84f6dd620000c7.dir
      size: 60954261
      nfiles: 298
  cae_pretraining:
    cmd: python3 src/cae_pretraining.py
    deps:
    - path: data/raw/tiny-imagenet-200
      md5: 7a16a4c11bed2b39c5d20c304e85355c.dir
      size: 236686390
      nfiles: 120003
    - path: models/casting/bin/hp_search_best.hdf5
      md5: f2725b3b2445bf2d6928acd8b0e180c7
      size: 6864888
    - path: src/cae_pretraining.py
      md5: e71a30f9e121c5fb5f84f3cca3ce274c
      size: 4699
    - path: src/utils/data/tfdatasets.py
      md5: c7d7d9a5829e73694eb2e4c3a2a0adaa
      size: 6557
    - path: src/utils/dvc/params.py
      md5: d87b352ff952b8466547c02182996e48
      size: 1285
    - path: src/utils/misc.py
      md5: ab4362add47aec072540aab167654b6c
      size: 4339
    - path: src/utils/models/kerasaux.py
      md5: b505bbc88bdc0d5b68197a2468e34a7e
      size: 11747
    params:
      params.yaml:
        all.dataset: casting
        all.grayscale: true
        all.input_size:
        - 232
        - 232
        - 1
        all.random_brightness: 0.05
        all.random_contrast: 0.05
        all.random_crop:
        - 224
        - 224
        all.random_flip: horizontal_and_vertical
        all.random_rotation: 1
        all.random_translation_height:
        - -0.05
        - 0.05
        all.random_translation_width:
        - -0.05
        - 0.05
        all.random_zoom:
        - -0.05
        - 0.05
        all.scale: 255
        all.seed: 13
        cae_pretraining.alpha: 0.98
        cae_pretraining.batch_size: 8
        cae_pretraining.beta: 0.93
        cae_pretraining.early_stopping: true
        cae_pretraining.epochs: 2
        cae_pretraining.learning_rate: 0.0015
        cae_pretraining.min_lr: 1e-05
        cae_pretraining.patience: 3
        cae_pretraining.revive_best: false
    outs:
    - path: models/casting/bin/pretrained_cae.hdf5
      md5: 79ddfed4c83f6a759884f5abf106915e
      size: 20357072
    - path: models/casting/logs/pretraining_history.csv
      md5: bfbd0cff5c59c921e8ff964e432b46f5
      size: 44
  cae_training:
    cmd: python3 src/cae_training.py
    deps:
    - path: data/processed/casting/train
      md5: 1f4833d5d268687f067ae427f9ba5046.dir
      size: 25933889
      nfiles: 1039
    - path: data/processed/casting/val
      md5: 76e2daf77649bf04d10716ce03bf6394.dir
      size: 3207251
      nfiles: 129
    - path: models/casting/bin/pretrained_cae.hdf5
      md5: 79ddfed4c83f6a759884f5abf106915e
      size: 20357072
    - path: src/cae_training.py
      md5: 675ab5e23dec6e50d5c35619c691cf49
      size: 4467
    - path: src/utils/data/tfdatasets.py
      md5: c7d7d9a5829e73694eb2e4c3a2a0adaa
      size: 6557
    - path: src/utils/dvc/params.py
      md5: d87b352ff952b8466547c02182996e48
      size: 1285
    - path: src/utils/models/kerasaux.py
      md5: b505bbc88bdc0d5b68197a2468e34a7e
      size: 11747
    params:
      params.yaml:
        all.dataset: casting
        all.grayscale: true
        all.input_size:
        - 232
        - 232
        - 1
        all.random_brightness: 0.05
        all.random_contrast: 0.05
        all.random_crop:
        - 224
        - 224
        all.random_flip: horizontal_and_vertical
        all.random_rotation: 1
        all.random_translation_height:
        - -0.05
        - 0.05
        all.random_translation_width:
        - -0.05
        - 0.05
        all.random_zoom:
        - -0.05
        - 0.05
        all.scale: 255
        all.seed: 13
        cae_training.alpha: 0.98
        cae_training.batch_size: 8
        cae_training.beta: 0.93
        cae_training.early_stopping: false
        cae_training.epochs: 130
        cae_training.min_lr: 1e-05
        cae_training.patience: 5
        cae_training.revive_best: true
    outs:
    - path: models/casting/bin/trained_cae.hdf5
      md5: 4ce1ce4f0a849ca22f9be078df9eac83
      size: 20358104
    - path: models/casting/logs/training_history.csv
      md5: baebecf9aaece7ec46235496279ab679
      size: 16533
  calculate_reconstruction_mse:
    cmd: python3 src/calculate_reconstruction_mse.py
    deps:
    - path: data/processed/casting/test
      md5: d245fc8b63006e526dd4ede868c6a663.dir
      size: 3261243
      nfiles: 132
    - path: data/processed/casting/train
      md5: 1f4833d5d268687f067ae427f9ba5046.dir
      size: 25933889
      nfiles: 1039
    - path: data/processed/casting/val
      md5: 76e2daf77649bf04d10716ce03bf6394.dir
      size: 3207251
      nfiles: 129
    - path: models/casting/bin/trained_cae.hdf5
      md5: 4ce1ce4f0a849ca22f9be078df9eac83
      size: 20358104
    - path: src/calculate_reconstruction_mse.py
      md5: d5635fdf04b657417b6a60b14114deeb
      size: 3254
    - path: src/utils/data/complexityaux.py
      md5: 00a8cf627941ec76b0633d67646990f7
      size: 6469
    - path: src/utils/dvc/params.py
      md5: d87b352ff952b8466547c02182996e48
      size: 1285
    params:
      params.yaml:
        all.dataset: casting
        all.grayscale: true
        all.scale: 255
    outs:
    - path: data/processed/casting/tabular/cae_mse.csv
      md5: 239f9f2b61b64d8e6405c08c3406369f
      size: 125131
    - path: visualisation/casting/caemse_hist.png
      md5: dec0c13be60a22917188be5ae4b3ffb8
      size: 20981
  merge_complexity_caemse:
    cmd: python3 src/merge_complexity_caemse.py
    deps:
    - path: data/processed/casting/tabular/cae_mse.csv
      md5: 239f9f2b61b64d8e6405c08c3406369f
      size: 125131
    - path: data/processed/casting/tabular/complexity.csv
      md5: 022eb21cb936a10753c6702ed6ced1b7
      size: 148809
    - path: src/merge_complexity_caemse.py
      md5: 6130db19c6c38fcfc7dfc696399861e6
      size: 4667
    - path: src/utils/dvc/params.py
      md5: d87b352ff952b8466547c02182996e48
      size: 1285
    params:
      params.yaml:
        all.dataset: casting
    outs:
    - path: data/processed/casting/tabular/complexity_caemse.csv
      md5: a3deac7b2022b845716493c936d59727
      size: 164996
    - path: visualisation/casting/complexity_vs_caemse.html
      md5: 52dab7458e19c8ea0e2192ba257f0056
      size: 108283
  metrify_reconstruction:
    cmd: python3 src/metrify_reconstruction.py
    deps:
    - path: data/processed/casting/tabular/cae_mse.csv
      md5: 239f9f2b61b64d8e6405c08c3406369f
      size: 125131
    - path: src/metrify_reconstruction.py
      md5: b120430d020f19da4fc4e026cb73c77f
      size: 3505
    - path: src/utils/dvc/params.py
      md5: d87b352ff952b8466547c02182996e48
      size: 1285
    outs:
    - path: metrics/casting/reconstruction_data.csv
      md5: 191e5b92d3b62c4763dbb3171a266da2
      size: 479
    - path: metrics/casting/reconstruction_metrics.json
      md5: 7a09fd94c710299605cae023fd59c887
      size: 679
    - path: visualisation/casting/reconstruction_metrics.html
      md5: 6b0d6649c6f9375835aab607c4ba391b
      size: 3584174
  train_classifier_models:
    cmd: python3 src/train_classifier_models.py
    deps:
    - path: data/processed/casting/tabular/complexity_caemse.csv
      md5: a3deac7b2022b845716493c936d59727
      size: 164996
    - path: src/train_classifier_models.py
      md5: abee4fc383d8b75ac0627a85415f567c
      size: 2980
    - path: src/utils/dvc/params.py
      md5: d87b352ff952b8466547c02182996e48
      size: 1285
    - path: src/utils/misc.py
      md5: ab4362add47aec072540aab167654b6c
      size: 4339
    params:
      params.yaml:
        all.dataset: casting
        train_classifier_models.models_n_iter: 25
        train_classifier_models.models_n_splits: 10
        train_classifier_models.models_score_func: f1
    outs:
    - path: models/casting/bin/logistic_regression_autoencoder.joblib
      md5: 3393e49286dfd1452959d30a5799714d
      size: 1259
    - path: models/casting/bin/logistic_regression_combined.joblib
      md5: e4bc59049338798caaee5784e83fea03
      size: 1323
    - path: models/casting/bin/logistic_regression_complexity.joblib
      md5: 8eae3a096fa77d3c7d5470ecceea88c1
      size: 1291
  evaluate:
    cmd: python3 src/evaluate.py
    deps:
    - path: data/processed/casting/tabular/cae_mse.csv
      md5: 239f9f2b61b64d8e6405c08c3406369f
      size: 125131
    - path: data/processed/casting/tabular/complexity.csv
      md5: 022eb21cb936a10753c6702ed6ced1b7
      size: 148809
    - path: models/casting/bin/logistic_regression_autoencoder.joblib
      md5: 3393e49286dfd1452959d30a5799714d
      size: 1259
    - path: models/casting/bin/logistic_regression_combined.joblib
      md5: e4bc59049338798caaee5784e83fea03
      size: 1323
    - path: models/casting/bin/logistic_regression_complexity.joblib
      md5: 8eae3a096fa77d3c7d5470ecceea88c1
      size: 1291
    - path: src/evaluate.py
      md5: 35e5fed71c7f2a923c523c9175596b8f
      size: 3327
    - path: src/utils/dvc/params.py
      md5: d87b352ff952b8466547c02182996e48
      size: 1285
    - path: src/utils/evaluation/classification_metrics.py
      md5: d2e336e71ad47cc7fca0f42b3d9c818d
      size: 990
    outs:
    - path: metrics/casting/autoencoder_metrics.json
      md5: 9386b19f7e5c3542562343731891d49f
      size: 114
    - path: metrics/casting/combined_metrics.json
      md5: 1aa44f985e965c94268a8e16774a250f
      size: 128
    - path: metrics/casting/complexity_metrics.json
      md5: 1aa44f985e965c94268a8e16774a250f
      size: 128
    - path: visualisation/casting/autoencoder_confusion_matrix.png
      md5: 0b59736a9f983e489dee40c83860f40d
      size: 19302
    - path: visualisation/casting/combined_confusion_matrix.png
      md5: 35b3a03c2eceba327cf7605478354479
      size: 18578
    - path: visualisation/casting/complexity_confusion_matrix.png
      md5: 35b3a03c2eceba327cf7605478354479
      size: 18578
